<!DOCTYPE html>
<HTML>
<head>
<title>Auto Head Fix 3</title>
<META NAME="AUTHOR" CONTENT="Jamie Boyd">
</head><body>
<H1>Notes for AHF version 3</H1>
<h2>Settings</h2>
<p>Cage settings and Experiment settings will no longer be kept in separate files, but will be stored in a single file and loaded together into one dictionary, and used to initialize a single object called task. That way, only one object has to be passed around. Individual variables for things like GPIO pin numbers will not be created, functions will refer to task.GPIOpin. Try to remove disconnect between changing, saving hardware settings in the JSON files and in the task dictionary in the running program.</p>
<p>What experiment information needs to be separate for each mouse? The Stimulator class will define a lot of task specific stuff, each mouse will have an entry for a stimulator dictionary containing information specific to that mouse. Other things:
Reward sizes
number of entry rewards
head-fix proportions
Maybe keep these things in experiment settings as defaults, so if a Mouse is created without these values, it gets the global ones as defaults.</p>
<p>need better management of mouse data within the program, will want to add images, lever position arrays, other non-text data to mouse. pickle or some other serializer thing. Where and how is this data stored? </p>

<h3>Hardware and Task Flexibility with more sub-classable options</h3>
<p>More things are optional, and more hardware is subclassable for different ways of doing things. AHF_HeadFixer, AHF_Rewarder, AHF_Stimulator, AHF_ContactChecker, and AHF_Camera are all base classes that load no harware specific modules. They must be subclassed to do actually do anything.  The base class defines the functions the subclasses must provide, and contain static functions  for getting class names and importing classes, and allowing the user to select one of the subclasses. Each subclass must provide a static function to querry the user for settings, and to return a dictionary with those settings. The subclasses must also specify a test function for use withg the hardWare tester.</p>
<p>
<table cellspacing = "0" cellpadding = "0" border = 1>
<caption>Hardware for AutoHeadFix Systems</caption>
<tbody>
<tr><td>Hardware</td><td>Description</td><td>Is Required?</td><td>Is Subclassed?</td></tr>
<tr><td>HeadFixer</td><td>Stabilizes head for imaging</td><td>No</td><td>Yes</td></tr>
<tr><td>Camera</td><td>Brain imaging camera controlled by Pi</td><td>No</td><td>Yes</td></tr> 
<tr><td>Rewarder</td><td>Provides rewards for training, water droplet, e.g.</td><td>Yes</td><td>Yes</td></tr>
<tr><td>Stimulator</td><td>Controls task-specific hardware during headfix session</td><td>Yes</td><td>Yes</td></tr> 
<tr><td>ContactChecker</td><td>Sgnals that mouse is in position for head fixing or interacting</td><td>Yes</td><td>Yes</td></tr>
<tr><td>TagReader</td><td>Innovations Design RFID reader with tag-in-range pin</td><td>Yes</td><td>No</td></tr>
<tr><td>LickDetector</td><td>Touch sensor based on mpr121 connected to lick port</td><td>No</td><td>No</td></tr>
<tr><td>Brain LED</td><td>SIngle GPIO output that turns on brain illimination LED</td><td>Yes</td><td>Not a Class</td></tr>
</tbody>
</table></p>
<h2>Program Flow Description</h2>
<p>COnfigutation file is loaded or created, task object is created, hardware is initializaed, files for saving data are created. Program enters the top-level loop, waiting on the global variable globalTag to switch from 0. Mouse enters the tube. The tagReader callback reads the tag, and changes global variable globalTag from 0 to the mouse's id. 
<H2>Remote control of AHF program using watchdog (pip3 install watchdog) ?</H2>
</body>
</html>
